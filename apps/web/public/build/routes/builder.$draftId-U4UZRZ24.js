import{a as A,b as I,d as P}from"/build/_shared/chunk-RRANPFQE.js";import{a as V}from"/build/_shared/chunk-KPWQHS6G.js";import{a as U,c as k,f as D,m as T,q as w}from"/build/_shared/chunk-2C25HZ32.js";import{b as R,d as g}from"/build/_shared/chunk-T36URGAI.js";var O=R((J,q)=>{q.exports={}});var j=g(V(),1);var H=g(O(),1);var S=class{script;maxNodes=100;constructor(t){this.script=t}runNode(t,i){let f=[];if(t.visitedNodes.length>this.maxNodes)throw new Error("Interview cycle detected: too many nodes visited");let e=this.script.nodes[t.currentNodeId];if(!e)throw new Error(`Node not found: ${t.currentNodeId}`);let o={...t};if(i!==void 0&&e.type==="question"){if(e.validate&&!e.validate(i))throw new Error(`Invalid answer for node ${e.id}`);o.answers={...o.answers,[e.id]:i},o.specDraft=this.updateSpecFromAnswer(o.specDraft,e.field,i),f.push({type:"answer_changed",nodeId:e.id,timestamp:Date.now(),data:{answer:i,field:e.field}})}let r=null;switch(e.type){case"question":let d=Object.keys(this.script.nodes),p=d.indexOf(t.currentNodeId);p>=0&&p<d.length-1?r=d[p+1]:r="end";break;case"branch":if(e.condition(o.answers))r=e.next;else{let s=Object.keys(this.script.nodes),c=s.indexOf(t.currentNodeId);c>=0&&c<s.length-1?r=s[c+1]:r="end"}break;case"end":f.push({type:"interview_completed",nodeId:e.id,timestamp:Date.now()});break}return r&&(o.currentNodeId=r,o.visitedNodes=[...o.visitedNodes,t.currentNodeId],f.push({type:"node_visited",nodeId:r,timestamp:Date.now()})),{nextNodeId:r,updatedState:o,events:f}}updateSpecFromAnswer(t,i,f){let e=i.split("."),o={...t},r=o.payload;r||(o.payload={},r=o.payload);for(let d=0;d<e.length-1;d++)r[e[d]]||(r[e[d]]={}),r=r[e[d]];return r[e[e.length-1]]=f,{...o,updatedAt:new Date().toISOString()}}getCurrentNode(t){let i=this.script.nodes[t.currentNodeId];if(!i)throw new Error(`Node not found: ${t.currentNodeId}`);return i}isComplete(t){return t.currentNodeId==="end"}};var v={id:"generic-agent",name:"Generic Agent Interview",startNodeId:"agent-name",nodes:{"agent-name":{type:"question",id:"agent-name",prompt:"What would you like to name your agent?",field:"meta.name",inputType:"text",required:!0,validate:a=>typeof a=="string"&&a.length>0},"agent-description":{type:"question",id:"agent-description",prompt:"Describe what your agent does",field:"meta.description",inputType:"textarea",required:!1},"agent-prompt":{type:"question",id:"agent-prompt",prompt:"What should be the main prompt/instruction for your agent?",field:"prompt.template",inputType:"textarea",required:!0,validate:a=>typeof a=="string"&&a.length>10},"model-provider":{type:"question",id:"model-provider",prompt:"Which AI model provider would you like to use?",field:"model.provider",inputType:"select",options:["openai","anthropic","google"],required:!0},"budget-limit":{type:"question",id:"budget-limit",prompt:"Set a budget limit in USD (optional, leave empty for no limit)",field:"limits.budgetUsd",inputType:"number",required:!1,validate:a=>a===""||typeof a=="number"&&a>=0},end:{type:"end",id:"end"}}},x={id:"chatbot",name:"Chatbot Interview",startNodeId:"chatbot-name",nodes:{"chatbot-name":{type:"question",id:"chatbot-name",prompt:"What should we call your chatbot?",field:"meta.name",inputType:"text",required:!0},"chatbot-personality":{type:"question",id:"chatbot-personality",prompt:"Describe your chatbot's personality and tone",field:"prompt.template",inputType:"textarea",required:!0},"knowledge-domain":{type:"question",id:"knowledge-domain",prompt:"What domain or topic should your chatbot be expert in?",field:"meta.description",inputType:"text",required:!1},end:{type:"end",id:"end"}}};var E={id:"chatbot",name:"Chatbot",description:"Create a conversational AI chatbot for customer support, FAQ, or general chat",category:"chatbot",tags:["conversation","support","chat"],interview:x,defaultSpec:I({title:"My Chatbot",payload:{specVersion:"0.1.0",meta:{id:A(),name:"my-chatbot",description:"A friendly chatbot assistant",version:"1.0.0",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},variables:[],prompt:{template:"You are a helpful and friendly chatbot assistant. Answer questions clearly and helpfully."},model:{provider:"openai",model:"gpt-4",config:{temperature:.7,maxTokens:1e3}},tools:[],limits:{timeoutSec:30,budgetUsd:10}}})},L={id:"web-automation",name:"Web Automation Agent",description:"Automate web tasks like form filling, data extraction, and browser interactions",category:"web-automation",tags:["automation","web","scraping","forms"],interview:v,defaultSpec:I({title:"Web Automation Agent",payload:{specVersion:"0.1.0",meta:{id:A(),name:"web-automation-agent",description:"Automate web-based tasks",version:"1.0.0",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},variables:[{key:"target-url",name:"Target URL",type:"string",description:"The website URL to automate",required:!0}],prompt:{template:"You are a web automation specialist. Navigate to {{target-url}} and perform the requested automation tasks efficiently and accurately."},model:{provider:"openai",model:"gpt-4",config:{temperature:.3,maxTokens:2e3}},tools:[{kind:"http",allowDomains:["https://example.com"]}],limits:{timeoutSec:120,budgetUsd:20}}})},W={id:"api-copilot",name:"API Copilot",description:"Help users interact with APIs, generate code, and troubleshoot API issues",category:"api-copilot",tags:["api","development","coding","debugging"],interview:v,defaultSpec:I({title:"API Copilot",payload:{specVersion:"0.1.0",meta:{id:A(),name:"api-copilot",description:"Expert assistant for API development and integration",version:"1.0.0",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},variables:[{key:"api-docs",name:"API Documentation",type:"string",description:"Link to API documentation or OpenAPI spec",required:!1}],prompt:{template:"You are an expert API development assistant. Help users with API integration, code generation, debugging, and best practices. Reference the API docs: {{api-docs}}"},model:{provider:"openai",model:"gpt-4",config:{temperature:.2,maxTokens:3e3}},tools:[{kind:"http",allowDomains:["https://api.example.com"]},{kind:"code-interpreter",timeoutSec:30}],limits:{timeoutSec:60,budgetUsd:15}}})},b=[E,L,W];var u=g(w(),1);function B({onSelect:a}){return(0,u.jsxs)("div",{className:"template-picker",children:[(0,u.jsx)("h3",{children:"Select a template"}),(0,u.jsx)("div",{className:"template-grid",children:b.map(t=>(0,u.jsxs)("button",{className:"template-card",onClick:()=>a(t.id),children:[(0,u.jsx)("div",{className:"template-name",children:t.name}),(0,u.jsx)("div",{className:"template-desc",children:t.description}),t.tags&&(0,u.jsx)("div",{className:"template-tags",children:t.tags.map(i=>(0,u.jsx)("span",{className:"tag",children:i},i))})]},t.id))})]})}var C=B;var y=g(U(),1);var l=g(w(),1);function N({script:a,initialState:t,onStateChange:i,onAutosave:f}){let e=(0,y.useMemo)(()=>new S(a),[a]),[o,r]=(0,y.useState)(t),[d]=(0,y.useState)(()=>P(n=>f?.(n),800));(0,y.useEffect)(()=>{i?.(o),d(o)},[o]);let p=e.getCurrentNode(o),s=n=>{let{updatedState:h}=e.runNode(o,n);r(h)},c=()=>{switch(p.inputType){case"text":return(0,l.jsx)("input",{type:"text",defaultValue:o.answers[p.id]||"",onBlur:n=>s(n.target.value)});case"textarea":return(0,l.jsx)("textarea",{defaultValue:o.answers[p.id]||"",onBlur:n=>s(n.target.value)});case"number":return(0,l.jsx)("input",{type:"number",defaultValue:o.answers[p.id]||"",onBlur:n=>s(Number(n.target.value))});case"select":return(0,l.jsxs)("select",{defaultValue:o.answers[p.id]||"",onChange:n=>s(n.target.value),children:[(0,l.jsx)("option",{value:"",disabled:!0,children:"Select..."}),p.options?.map(n=>(0,l.jsx)("option",{value:n,children:n},n))]});default:return null}};return p.type==="end"?(0,l.jsx)("div",{className:"interview-complete",children:"Interview complete."}):(0,l.jsx)("div",{className:"interview-panel",children:(0,l.jsxs)("div",{className:"question",children:[(0,l.jsx)("label",{children:p.prompt}),(0,l.jsx)("div",{className:"control",children:c()})]})})}var m=g(w(),1);function F(){let{draft:a}=T(),[t,i]=D(),f=k(),e=t.get("template"),o=async s=>{let c=b.find(h=>h.id===s);if(!c)return;(await fetch("/builder/"+a.id,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:a.id,title:a.title,templateId:c.id,payload:c.defaultSpec.payload,isDraft:!0,status:"DRAFT"})})).ok&&i(h=>(h.set("template",c.id),h))},r=e?b.find(s=>s.id===e)?.interview||v:v,d={answers:{},currentNodeId:r.startNodeId||"agent-name",specDraft:a,visitedNodes:[]};return(0,m.jsxs)("div",{className:"builder-layout",children:[(0,m.jsx)("div",{className:"builder-top",children:!e&&(0,m.jsx)(C,{onSelect:o})}),(0,m.jsxs)("div",{className:"builder-content",children:[(0,m.jsx)("div",{className:"builder-left",children:(0,m.jsx)(N,{script:r,initialState:d,onAutosave:async s=>{await fetch("/builder/"+a.id,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:a.id,title:a.title,templateId:e??void 0,payload:s.specDraft.payload,isDraft:!0,status:"DRAFT"})})}})}),(0,m.jsx)("div",{className:"builder-right",children:(0,m.jsx)("pre",{style:{maxHeight:500,overflow:"auto",background:"#0b0b0e",color:"#ddd",padding:12},children:JSON.stringify(d.specDraft.payload,null,2)})})]})]})}export{F as default};
