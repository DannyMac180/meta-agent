import{a as R,b as I}from"/build/_shared/chunk-SIAUL2YD.js";import{a as B}from"/build/_shared/chunk-KPWQHS6G.js";import{a as P,c as S,e as N,k as E,o as C}from"/build/_shared/chunk-KLJEBJ3A.js";import{d}from"/build/_shared/chunk-T36URGAI.js";var n=d(P(),1),k=d(B(),1);var t=d(C(),1);function F(){let{draft:i}=E(),m=N(),L=S(),[c,f]=(0,n.useState)(()=>JSON.stringify(i.spec,null,2)),[o,j]=(0,n.useState)(),[r,g]=(0,n.useState)({name:i.name,tags:i.tags||[]}),[O,l]=(0,n.useState)(!1),[v,h]=(0,n.useState)(!1),y=(0,n.useRef)(null);(0,n.useEffect)(()=>{let e=a=>{a.preventDefault(),b()};return window.addEventListener("editor-save",e),()=>window.removeEventListener("editor-save",e)},[c,r,o]);let x=e=>{f(e),l(!0)},A=e=>{j(e)},b=()=>{if(o&&o.length>0){alert("Cannot save spec with validation errors. Please fix them first.");return}let e=new FormData;e.append("intent","save"),e.append("name",r.name),e.append("spec",c),e.append("tags",JSON.stringify(r.tags)),m(e,{method:"post"})},V=()=>{if(confirm("Are you sure you want to delete this draft? This action cannot be undone.")){let e=new FormData;e.append("intent","delete"),m(e,{method:"post"})}},T=()=>{y.current?.click()},J=e=>{let a=e.target.files?.[0];if(!a)return;if(a.size>200*1024){alert("File too large (>200KB)");return}h(!0);let s=new FileReader;s.onload=U=>{try{let u=U.target?.result;f(u),l(!0);try{let D=JSON.parse(u);D.meta?.name&&g(M=>({...M,name:D.meta.name}))}catch{}}catch{alert("Failed to read file")}finally{h(!1)}},s.readAsText(a)},$=()=>{let e=new Blob([c],{type:"application/json"}),a=URL.createObjectURL(e),s=document.createElement("a");s.href=a,s.download=`${r.name}.json`,document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(a)},w=!o||o.length===0,p=L.state==="submitting";return(0,t.jsxs)("div",{className:"spec-editor-page",children:[(0,t.jsxs)("header",{className:"spec-editor-header",children:[(0,t.jsxs)("div",{className:"spec-meta",children:[(0,t.jsx)("input",{type:"text",value:r.name,onChange:e=>{g(a=>({...a,name:e.target.value})),l(!0)},className:"spec-name-input",placeholder:"Spec name"}),(0,t.jsxs)("span",{className:"draft-id",children:["ID: ",i.id]}),O&&(0,t.jsx)("span",{className:"dirty-indicator",children:"\u25CF"})]}),(0,t.jsxs)("div",{className:"spec-actions",children:[(0,t.jsx)("button",{onClick:T,disabled:v,children:v?"Importing...":"Import"}),(0,t.jsx)("button",{onClick:$,children:"Export"}),(0,t.jsx)("button",{onClick:V,className:"delete-button",disabled:p,children:"Delete"}),(0,t.jsx)("button",{onClick:b,disabled:!w||p,className:w?"save-button-valid":"save-button-invalid",children:p?"Saving...":"Save Draft"})]})]}),(0,t.jsxs)("div",{className:"spec-editor-content",children:[(0,t.jsx)("div",{className:"spec-editor-main",children:(0,t.jsx)(R,{value:c,onChange:x,onValidationChange:A})}),(0,t.jsx)("div",{className:"spec-editor-sidebar",children:(0,t.jsx)(I,{errors:o,onErrorClick:e=>{console.log("Focus error:",e)}})})]}),(0,t.jsx)("input",{ref:y,type:"file",accept:".json,.yaml,.yml",style:{display:"none"},onChange:J})]})}export{F as default};
